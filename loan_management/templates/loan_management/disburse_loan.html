{% extends 'common_base.html' %}
{% block common_title %}Loan Detail{% endblock %}
{% block common_common_body %}
  {% for message in messages %}
    <div class="mb-4 rounded-md p-4 text-sm {% if message.tags == 'error' %} bg-red-100 text-red-700 {% elif message.tags == 'success' %} bg-green-100 text-green-700 {% elif message.tags == 'warning' %} bg-yellow-100 text-yellow-700 {% elif message.tags == 'info' %} bg-blue-100 text-blue-700 {% else %} bg-gray-100 text-gray-700 {% endif %}"
         role="alert">
      <p class="font-medium">{{ message }}</p>
    </div>
  {% endfor %}
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Loan #{{ loan.id }} - {{ loan.member.name }}</h1>
    <span class="px-4 py-2 rounded-full {% if loan.status == 'ACTIVE' %}bg-green-100 text-green-800 {% elif loan.status == 'PENDING' %}bg-yellow-100 text-yellow-800 {% elif loan.status == 'FULLYPAID' %}bg-blue-100 text-blue-800 {% else %}bg-gray-100 text-gray-800{% endif %}">
      {{ loan.get_status_display }}
    </span>
  </div>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Loan Overview Card -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-semibold mb-4">Loan Overview</h2>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <p class="text-gray-600">Amount</p>
          <p class="font-semibold">${{ loan.amount }}</p>
        </div>
        <div>
          <p class="text-gray-600">Outstanding</p>
          <p class="font-semibold">${{ loan.outstanding_principal }}</p>
        </div>
        <div>
          <p class="text-gray-600">Interest Rate</p>
          <p class="font-semibold">{{ loan.interest_rate }}%</p>
        </div>
        <div>
          <p class="text-gray-600">Term</p>
          <p class="font-semibold">{{ loan.term }} months</p>
        </div>
        <div>
          <p class="text-gray-600">Started</p>
          <p class="font-semibold">{{ loan.started_at }}</p>
        </div>
        <div>
          <p class="text-gray-600">End</p>
          <p class="font-semibold">{{ loan.end_at }}</p>
        </div>
        <div>
          <p class="text-gray-600">Disbursed</p>
          <p class="font-semibold">{{ loan.disbursed_at }}</p>
        </div>
        <div>
          <p class="text-gray-600">Pending Disbursement</p>
          <p class="font-semibold">{{ pending_disbursement }}</p>
        </div>
      </div>
    </div>
    <!-- Disbursement Card -->
    <div class="bg-white rounded-lg shadow p-6">
      <h2 class="text-xl font-semibold mb-4">Disburse Loan</h2>
      <form method="post" class="space-y-4">
        {% csrf_token %}
        <div id="amount-field">{{ form.amount }}</div>
        {% if form.errors %}<div class="text-red-500 text-sm">{{ form.errors }}</div>{% endif %}
        <button type="submit"
                class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition duration-200">
          Disburse Now
        </button>
      </form>
    </div>
  </div>
{% endblock %}
